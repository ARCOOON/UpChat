name: Git Rewrite Commits

on:
  workflow_dispatch:

env:
  BRANCH_NAME: ${{ github.head_ref || github.ref_name }}
  OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}

jobs:
  rewrite_commits_dry_run:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Run git-rewrite-commits dry run on last 100 commits
        run: |
          echo "Running git-rewrite-commits in dry-run mode on branch: ${BRANCH_NAME}"
          npx git-rewrite-commits --dry-run --max-commits 100 --branch "${BRANCH_NAME}" -no-skip-well-formed --model gpt-5-mini
